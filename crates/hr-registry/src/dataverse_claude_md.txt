<!-- DATAVERSE:START -->
# Dataverse Database

Ce workspace utilise Dataverse comme base de données. Le serveur MCP `dataverse` opère sur la **DB locale** de ce conteneur (`/root/workspace/.dataverse/app.db`).

## Architecture DB
- **DEV (ici)**: DB locale pour développer le schéma et tester les données (`/root/workspace/.dataverse/app.db`)
- **PROD**: DB de production avec les vraies données (`/opt/app/.dataverse/app.db`)
- Les modifications MCP affectent **uniquement la DB locale** — PROD n'est jamais modifiée directement
- Pour déployer le schéma vers PROD: utiliser `prod_push` avec le dossier `.dataverse/`

## Règles
- TOUJOURS utiliser les outils MCP Dataverse pour interagir avec la base de données locale
- JAMAIS modifier `/root/workspace/.dataverse/app.db` directement (pas de sqlite3 CLI, pas de scripts SQL ad-hoc)
- JAMAIS pousser la DB vers PROD sans que l'utilisateur l'ait explicitement demandé
- Le code applicatif runtime (sur PROD) utilise une librairie SQLite connectée à `/opt/app/.dataverse/app.db`

## Outils disponibles

### Consultation
- `list_tables` — Lister toutes les tables avec nombre de lignes
- `describe_table` — Schéma complet d'une table (colonnes, types, contraintes)
- `get_schema` — Schéma complet de la DB (tables, colonnes, relations)
- `get_db_info` — Statistiques (taille, nombre de tables, total lignes)
- `count_rows` — Compter les lignes avec filtres optionnels

### Schéma (DDL)
- `create_table` — Créer une table (id, created_at, updated_at sont automatiques)
- `add_column` / `remove_column` — Modifier la structure d'une table
- `create_relation` — Créer une relation entre tables (FK)
- `drop_table` — Supprimer une table (nécessite confirm=true)

### Données (CRUD)
- `query_data` — Lire des lignes avec filtres et pagination
- `insert_data` — Insérer des lignes
- `update_data` — Modifier des lignes selon filtres
- `delete_data` — Supprimer des lignes selon filtres

## Procédure
1. Avant toute opération, appeler `list_tables` pour voir l'état actuel
2. Utiliser `describe_table` pour comprendre le schéma avant de le modifier
3. Pour les changements de schéma, utiliser les outils DDL
4. Pour les opérations de données, utiliser les outils CRUD
5. Quand le schéma est prêt et que l'utilisateur le demande, déployer vers PROD avec `prod_push` (dossier `.dataverse/`)
<!-- DATAVERSE:END -->

<!-- DEPLOY:START -->
# Déploiement vers Production

Ce workspace est un **environnement de build** lié à un conteneur de production.
Vous développez et buildez ici, puis déployez sur la production via les outils MCP `deploy`.

## Architecture
- **Ici (DEV)**: code source, build tools, code-server IDE
- **Production (PROD)**: binaire déployé + assets statiques + base de données
- Pas d'endpoint public pour ce conteneur de dev — il sert uniquement à builder
- L'IDE code-server est accessible via `code.{slug}.{domaine}`

## Règles
- **JAMAIS déployer en production sauf si l'utilisateur l'a explicitement demandé**
- TOUJOURS builder le binaire AVANT de déployer (`cargo build --release`)
- TOUJOURS utiliser l'outil `deploy` du serveur MCP — JAMAIS copier manuellement
- Le binaire est déployé à `/opt/app/app` sur le conteneur de production
- Le service systemd `app.service` est créé/redémarré automatiquement

## Outils disponibles
- `deploy` — Déployer un binaire compilé vers la production (nécessite `binary_path`)
- `prod_status` — Vérifier le statut du service en production
- `prod_logs` — Consulter les logs du service en production
- `prod_exec` — Exécuter une commande shell sur la production
- `prod_push` — Copier un fichier ou dossier vers la production

## Procédure de déploiement
1. Builder le binaire: `cargo build --release`
2. Builder le frontend si applicable (dans le workspace)
3. Déployer le binaire avec l'outil MCP `deploy`
4. Pousser les assets statiques si besoin avec `prod_push`
5. Pousser la base de données si le schéma a changé: `prod_push` avec le dossier `.dataverse/`
6. Vérifier avec `prod_status` et `prod_logs`

## Applications mobiles (Flutter/Expo)
Pour les apps avec frontend mobile:
- Le backend tourne localement dans ce conteneur pendant le dev
- Le mobile se connecte via l'IP locale du conteneur (ex: `http://10.0.x.y:3000`)
- Pour la prod, déployer le backend sur PROD comme ci-dessus
<!-- DEPLOY:END -->

<!-- STORE:START -->
# HomeRoute Store (Publication d'apps)

Le serveur MCP `store` permet de publier et gérer des applications Android (APK) sur le HomeRoute Store.

## Règles
- **JAMAIS publier sur le Store sauf si l'utilisateur l'a explicitement demandé**
- En développement, les applications mobiles tournent en mode DEV (Flutter run ou Expo start) — ne pas builder d'APK sauf pour publication
- TOUJOURS builder l'APK AVANT de publier (`eas build` ou build Gradle local)
- Utiliser `list_store_apps` pour vérifier les apps existantes avant de publier
- Lors de la première publication, fournir obligatoirement: `name`, `slug`, `version`
- Incrémenter la version à chaque nouvelle release

## Outils disponibles
- `list_store_apps` — Lister toutes les apps disponibles dans le Store (noms, slugs, catégories, versions)
- `get_app_info` — Détails d'une app spécifique (versions, changelogs)
- `check_updates` — Vérifier les mises à jour disponibles pour des apps installées
- `publish_release` — Publier une nouvelle release APK sur le Store

## Procédure de publication
1. Builder l'APK (ex: `eas build --platform android --profile preview --local` ou `flutter build apk`)
2. Vérifier avec `list_store_apps` si l'app existe déjà
3. Publier avec `publish_release` en fournissant: `apk_path`, `slug`, `version`
4. Pour une première publication, ajouter aussi: `name`, `description`, `category`
5. Vérifier avec `get_app_info` que la release apparaît dans le Store
<!-- STORE:END -->
